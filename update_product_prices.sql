-- SQL Script to Update Product Prices
-- This script updates product prices using the code as reference
-- Based on the data from public/precios.csv

-- First, let's check what products exist in the database
SELECT 
    'DEBUG: Checking existing products' as info,
    COUNT(*) as total_products_in_db
FROM products;

-- Check which products from our CSV exist in the database
SELECT 
    'DEBUG: Products that exist in database' as info,
    code,
    description,
    price as current_price
FROM products 
WHERE code IN (
    'PCO005003', 'PCO006003', 'PCO006007', 'PCO007005', 'PCO007001', 'PCO007009', 'PCO007014',
    'PCO010001', 'PCO010002', 'PCO010004', 'PCO010024', 'PCO010025', 'PCO010017', 'PCO010010',
    'PCO011001', 'PCO011002', 'PCO011003', 'PCO011018', 'PCO013006', 'PCO013011', 'PCO013002',
    'PCO013009', 'PCO013007', 'PCO013010', 'PCO013001', 'PCO013008', 'PCO015025', 'PCO015003',
    'PCO015014', 'PCO015032', 'PCO015028', 'PCO019027', 'PCO019046', 'PCO020011', 'PCO023002',
    'PCO027003', 'PCO027007', 'PCO027004', 'PCO027008', 'PCO027001', 'PCO027005', 'PCO027002',
    'PCO027006', 'PCO028003', 'PCO028001', 'PCO028004', 'PCO028002', 'PCO028006', 'PCO028008',
    'PCO028005', 'PCO028007', 'PCO029004', 'PCO029003', 'PCO029005', 'PCO029002', 'PCO031019',
    'PCO031005', 'PCO031016', 'PCO031004', 'PCO032019', 'PCO032015', 'PCO032005', 'PCO032017',
    'PCO032012', 'PCO032004', 'PCO032020', 'PCO036003', 'CHB000002', 'COD000006'
)
ORDER BY code;

-- Check which products from our CSV DON'T exist in the database
SELECT 
    'DEBUG: Products NOT found in database' as info,
    csv_code.code
FROM (
    SELECT 'PCO005003' as code UNION ALL SELECT 'PCO006003' UNION ALL SELECT 'PCO006007' UNION ALL
    SELECT 'PCO007005' UNION ALL SELECT 'PCO007001' UNION ALL SELECT 'PCO007009' UNION ALL
    SELECT 'PCO007014' UNION ALL SELECT 'PCO010001' UNION ALL SELECT 'PCO010002' UNION ALL
    SELECT 'PCO010004' UNION ALL SELECT 'PCO010024' UNION ALL SELECT 'PCO010025' UNION ALL
    SELECT 'PCO010017' UNION ALL SELECT 'PCO010010' UNION ALL SELECT 'PCO011001' UNION ALL
    SELECT 'PCO011002' UNION ALL SELECT 'PCO011003' UNION ALL SELECT 'PCO011018' UNION ALL
    SELECT 'PCO013006' UNION ALL SELECT 'PCO013011' UNION ALL SELECT 'PCO013002' UNION ALL
    SELECT 'PCO013009' UNION ALL SELECT 'PCO013007' UNION ALL SELECT 'PCO013010' UNION ALL
    SELECT 'PCO013001' UNION ALL SELECT 'PCO013008' UNION ALL SELECT 'PCO015025' UNION ALL
    SELECT 'PCO015003' UNION ALL SELECT 'PCO015014' UNION ALL SELECT 'PCO015032' UNION ALL
    SELECT 'PCO015028' UNION ALL SELECT 'PCO019027' UNION ALL SELECT 'PCO019046' UNION ALL
    SELECT 'PCO020011' UNION ALL SELECT 'PCO023002' UNION ALL SELECT 'PCO027003' UNION ALL
    SELECT 'PCO027007' UNION ALL SELECT 'PCO027004' UNION ALL SELECT 'PCO027008' UNION ALL
    SELECT 'PCO027001' UNION ALL SELECT 'PCO027005' UNION ALL SELECT 'PCO027002' UNION ALL
    SELECT 'PCO027006' UNION ALL SELECT 'PCO028003' UNION ALL SELECT 'PCO028001' UNION ALL
    SELECT 'PCO028004' UNION ALL SELECT 'PCO028002' UNION ALL SELECT 'PCO028006' UNION ALL
    SELECT 'PCO028008' UNION ALL SELECT 'PCO028005' UNION ALL SELECT 'PCO028007' UNION ALL
    SELECT 'PCO029004' UNION ALL SELECT 'PCO029003' UNION ALL SELECT 'PCO029005' UNION ALL
    SELECT 'PCO029002' UNION ALL SELECT 'PCO031019' UNION ALL SELECT 'PCO031005' UNION ALL
    SELECT 'PCO031016' UNION ALL SELECT 'PCO031004' UNION ALL SELECT 'PCO032019' UNION ALL
    SELECT 'PCO032015' UNION ALL SELECT 'PCO032005' UNION ALL SELECT 'PCO032017' UNION ALL
    SELECT 'PCO032012' UNION ALL SELECT 'PCO032004' UNION ALL SELECT 'PCO032020' UNION ALL
    SELECT 'PCO036003' UNION ALL SELECT 'CHB000002' UNION ALL SELECT 'COD000006'
) csv_code
LEFT JOIN products p ON csv_code.code = p.code
WHERE p.code IS NULL
ORDER BY csv_code.code;

-- Now perform the update with better error handling
UPDATE products 
SET price = CASE code
    WHEN 'PCO005003' THEN 73.09
    WHEN 'PCO006003' THEN 98.52
    WHEN 'PCO006007' THEN 50.00
    WHEN 'PCO007005' THEN 75.13
    WHEN 'PCO007001' THEN 50.85
    WHEN 'PCO007009' THEN 108.05
    WHEN 'PCO007014' THEN 44.61
    WHEN 'PCO010001' THEN 155.19
    WHEN 'PCO010002' THEN 155.19
    WHEN 'PCO010004' THEN 155.19
    WHEN 'PCO010024' THEN 155.19
    WHEN 'PCO010025' THEN 155.19
    WHEN 'PCO010017' THEN 248.31
    WHEN 'PCO010010' THEN 191.40
    WHEN 'PCO011001' THEN 133.32
    WHEN 'PCO011002' THEN 133.32
    WHEN 'PCO011003' THEN 133.32
    WHEN 'PCO011018' THEN 84.19
    WHEN 'PCO013006' THEN 140.00
    WHEN 'PCO013011' THEN 105.30
    WHEN 'PCO013002' THEN 103.46
    WHEN 'PCO013009' THEN 97.50
    WHEN 'PCO013007' THEN 105.00
    WHEN 'PCO013010' THEN 133.65
    WHEN 'PCO013001' THEN 80.00
    WHEN 'PCO013008' THEN 129.60
    WHEN 'PCO015025' THEN 236.92
    WHEN 'PCO015003' THEN 207.83
    WHEN 'PCO015014' THEN 236.92
    WHEN 'PCO015032' THEN 303.05
    WHEN 'PCO015028' THEN 203.85
    WHEN 'PCO019027' THEN 61.10
    WHEN 'PCO019046' THEN 72.75
    WHEN 'PCO020011' THEN 98.63
    WHEN 'PCO023002' THEN 92.99
    WHEN 'PCO027003' THEN 36.76
    WHEN 'PCO027007' THEN 46.02
    WHEN 'PCO027004' THEN 36.66
    WHEN 'PCO027008' THEN 44.69
    WHEN 'PCO027001' THEN 38.07
    WHEN 'PCO027005' THEN 49.12
    WHEN 'PCO027002' THEN 35.38
    WHEN 'PCO027006' THEN 48.81
    WHEN 'PCO028003' THEN 13.90
    WHEN 'PCO028001' THEN 12.48
    WHEN 'PCO028004' THEN 13.91
    WHEN 'PCO028002' THEN 12.50
    WHEN 'PCO028006' THEN 18.65
    WHEN 'PCO028008' THEN 34.94
    WHEN 'PCO028005' THEN 17.36
    WHEN 'PCO028007' THEN 32.08
    WHEN 'PCO029004' THEN 196.12
    WHEN 'PCO029003' THEN 175.14
    WHEN 'PCO029005' THEN 249.73
    WHEN 'PCO029002' THEN 153.57
    WHEN 'PCO031019' THEN 271.05
    WHEN 'PCO031005' THEN 302.93
    WHEN 'PCO031016' THEN 271.05
    WHEN 'PCO031004' THEN 302.93
    WHEN 'PCO032019' THEN 291.90
    WHEN 'PCO032015' THEN 271.05
    WHEN 'PCO032005' THEN 299.99
    WHEN 'PCO032017' THEN 271.05
    WHEN 'PCO032012' THEN 272.88
    WHEN 'PCO032004' THEN 302.93
    WHEN 'PCO032020' THEN 271.05
    WHEN 'PCO036003' THEN 40.04
    WHEN 'CHB000002' THEN 237.14
    WHEN 'COD000006' THEN 94.38
    ELSE price
END
WHERE code IN (
    'PCO005003', 'PCO006003', 'PCO006007', 'PCO007005', 'PCO007001', 'PCO007009', 'PCO007014',
    'PCO010001', 'PCO010002', 'PCO010004', 'PCO010024', 'PCO010025', 'PCO010017', 'PCO010010',
    'PCO011001', 'PCO011002', 'PCO011003', 'PCO011018', 'PCO013006', 'PCO013011', 'PCO013002',
    'PCO013009', 'PCO013007', 'PCO013010', 'PCO013001', 'PCO013008', 'PCO015025', 'PCO015003',
    'PCO015014', 'PCO015032', 'PCO015028', 'PCO019027', 'PCO019046', 'PCO020011', 'PCO023002',
    'PCO027003', 'PCO027007', 'PCO027004', 'PCO027008', 'PCO027001', 'PCO027005', 'PCO027002',
    'PCO027006', 'PCO028003', 'PCO028001', 'PCO028004', 'PCO028002', 'PCO028006', 'PCO028008',
    'PCO028005', 'PCO028007', 'PCO029004', 'PCO029003', 'PCO029005', 'PCO029002', 'PCO031019',
    'PCO031005', 'PCO031016', 'PCO031004', 'PCO032019', 'PCO032015', 'PCO032005', 'PCO032017',
    'PCO032012', 'PCO032004', 'PCO032020', 'PCO036003', 'CHB000002', 'COD000006'
);

-- Show the results after update
SELECT 
    'AFTER UPDATE: Products with updated prices' as info,
    code,
    description,
    price as new_price,
    'Updated' as status
FROM products 
WHERE code IN (
    'PCO005003', 'PCO006003', 'PCO006007', 'PCO007005', 'PCO007001', 'PCO007009', 'PCO007014',
    'PCO010001', 'PCO010002', 'PCO010004', 'PCO010024', 'PCO010025', 'PCO010017', 'PCO010010',
    'PCO011001', 'PCO011002', 'PCO011003', 'PCO011018', 'PCO013006', 'PCO013011', 'PCO013002',
    'PCO013009', 'PCO013007', 'PCO013010', 'PCO013001', 'PCO013008', 'PCO015025', 'PCO015003',
    'PCO015014', 'PCO015032', 'PCO015028', 'PCO019027', 'PCO019046', 'PCO020011', 'PCO023002',
    'PCO027003', 'PCO027007', 'PCO027004', 'PCO027008', 'PCO027001', 'PCO027005', 'PCO027002',
    'PCO027006', 'PCO028003', 'PCO028001', 'PCO028004', 'PCO028002', 'PCO028006', 'PCO028008',
    'PCO028005', 'PCO028007', 'PCO029004', 'PCO029003', 'PCO029005', 'PCO029002', 'PCO031019',
    'PCO031005', 'PCO031016', 'PCO031004', 'PCO032019', 'PCO032015', 'PCO032005', 'PCO032017',
    'PCO032012', 'PCO032004', 'PCO032020', 'PCO036003', 'CHB000002', 'COD000006'
)
ORDER BY code;

-- Show summary of update
SELECT 
    'SUMMARY: Update Results' as info,
    COUNT(*) as total_products_updated,
    'Products updated successfully' as message
FROM products 
WHERE code IN (
    'PCO005003', 'PCO006003', 'PCO006007', 'PCO007005', 'PCO007001', 'PCO007009', 'PCO007014',
    'PCO010001', 'PCO010002', 'PCO010004', 'PCO010024', 'PCO010025', 'PCO010017', 'PCO010010',
    'PCO011001', 'PCO011002', 'PCO011003', 'PCO011018', 'PCO013006', 'PCO013011', 'PCO013002',
    'PCO013009', 'PCO013007', 'PCO013010', 'PCO013001', 'PCO013008', 'PCO015025', 'PCO015003',
    'PCO015014', 'PCO015032', 'PCO015028', 'PCO019027', 'PCO019046', 'PCO020011', 'PCO023002',
    'PCO027003', 'PCO027007', 'PCO027004', 'PCO027008', 'PCO027001', 'PCO027005', 'PCO027002',
    'PCO027006', 'PCO028003', 'PCO028001', 'PCO028004', 'PCO028002', 'PCO028006', 'PCO028008',
    'PCO028005', 'PCO028007', 'PCO029004', 'PCO029003', 'PCO029005', 'PCO029002', 'PCO031019',
    'PCO031005', 'PCO031016', 'PCO031004', 'PCO032019', 'PCO032015', 'PCO032005', 'PCO032017',
    'PCO032012', 'PCO032004', 'PCO032020', 'PCO036003', 'CHB000002', 'COD000006'
);

-- Alternative approach: Update products one by one for better debugging
-- Uncomment the following section if the above doesn't work

/*
-- Update products individually for better debugging
UPDATE products SET price = 73.09 WHERE code = 'PCO005003';
UPDATE products SET price = 98.52 WHERE code = 'PCO006003';
UPDATE products SET price = 50.00 WHERE code = 'PCO006007';
UPDATE products SET price = 75.13 WHERE code = 'PCO007005';
UPDATE products SET price = 50.85 WHERE code = 'PCO007001';
UPDATE products SET price = 108.05 WHERE code = 'PCO007009';
UPDATE products SET price = 44.61 WHERE code = 'PCO007014';
UPDATE products SET price = 155.19 WHERE code = 'PCO010001';
UPDATE products SET price = 155.19 WHERE code = 'PCO010002';
UPDATE products SET price = 155.19 WHERE code = 'PCO010004';
UPDATE products SET price = 155.19 WHERE code = 'PCO010024';
UPDATE products SET price = 155.19 WHERE code = 'PCO010025';
UPDATE products SET price = 248.31 WHERE code = 'PCO010017';
UPDATE products SET price = 191.40 WHERE code = 'PCO010010';
UPDATE products SET price = 133.32 WHERE code = 'PCO011001';
UPDATE products SET price = 133.32 WHERE code = 'PCO011002';
UPDATE products SET price = 133.32 WHERE code = 'PCO011003';
UPDATE products SET price = 84.19 WHERE code = 'PCO011018';
UPDATE products SET price = 140.00 WHERE code = 'PCO013006';
UPDATE products SET price = 105.30 WHERE code = 'PCO013011';
UPDATE products SET price = 103.46 WHERE code = 'PCO013002';
UPDATE products SET price = 97.50 WHERE code = 'PCO013009';
UPDATE products SET price = 105.00 WHERE code = 'PCO013007';
UPDATE products SET price = 133.65 WHERE code = 'PCO013010';
UPDATE products SET price = 80.00 WHERE code = 'PCO013001';
UPDATE products SET price = 129.60 WHERE code = 'PCO013008';
UPDATE products SET price = 236.92 WHERE code = 'PCO015025';
UPDATE products SET price = 207.83 WHERE code = 'PCO015003';
UPDATE products SET price = 236.92 WHERE code = 'PCO015014';
UPDATE products SET price = 303.05 WHERE code = 'PCO015032';
UPDATE products SET price = 203.85 WHERE code = 'PCO015028';
UPDATE products SET price = 61.10 WHERE code = 'PCO019027';
UPDATE products SET price = 72.75 WHERE code = 'PCO019046';
UPDATE products SET price = 98.63 WHERE code = 'PCO020011';
UPDATE products SET price = 92.99 WHERE code = 'PCO023002';
UPDATE products SET price = 36.76 WHERE code = 'PCO027003';
UPDATE products SET price = 46.02 WHERE code = 'PCO027007';
UPDATE products SET price = 36.66 WHERE code = 'PCO027004';
UPDATE products SET price = 44.69 WHERE code = 'PCO027008';
UPDATE products SET price = 38.07 WHERE code = 'PCO027001';
UPDATE products SET price = 49.12 WHERE code = 'PCO027005';
UPDATE products SET price = 35.38 WHERE code = 'PCO027002';
UPDATE products SET price = 48.81 WHERE code = 'PCO027006';
UPDATE products SET price = 13.90 WHERE code = 'PCO028003';
UPDATE products SET price = 12.48 WHERE code = 'PCO028001';
UPDATE products SET price = 13.91 WHERE code = 'PCO028004';
UPDATE products SET price = 12.50 WHERE code = 'PCO028002';
UPDATE products SET price = 18.65 WHERE code = 'PCO028006';
UPDATE products SET price = 34.94 WHERE code = 'PCO028008';
UPDATE products SET price = 17.36 WHERE code = 'PCO028005';
UPDATE products SET price = 32.08 WHERE code = 'PCO028007';
UPDATE products SET price = 196.12 WHERE code = 'PCO029004';
UPDATE products SET price = 175.14 WHERE code = 'PCO029003';
UPDATE products SET price = 249.73 WHERE code = 'PCO029005';
UPDATE products SET price = 153.57 WHERE code = 'PCO029002';
UPDATE products SET price = 271.05 WHERE code = 'PCO031019';
UPDATE products SET price = 302.93 WHERE code = 'PCO031005';
UPDATE products SET price = 271.05 WHERE code = 'PCO031016';
UPDATE products SET price = 302.93 WHERE code = 'PCO031004';
UPDATE products SET price = 291.90 WHERE code = 'PCO032019';
UPDATE products SET price = 271.05 WHERE code = 'PCO032015';
UPDATE products SET price = 299.99 WHERE code = 'PCO032005';
UPDATE products SET price = 271.05 WHERE code = 'PCO032017';
UPDATE products SET price = 272.88 WHERE code = 'PCO032012';
UPDATE products SET price = 302.93 WHERE code = 'PCO032004';
UPDATE products SET price = 271.05 WHERE code = 'PCO032020';
UPDATE products SET price = 40.04 WHERE code = 'PCO036003';
UPDATE products SET price = 237.14 WHERE code = 'CHB000002';
UPDATE products SET price = 94.38 WHERE code = 'COD000006';
*/ 